generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  name      String
  password  String   // In production, this would be hashed
  rooms     Room[]
  createdAt DateTime @default(now())
}

model Room {
  id      Int      @id @default(autoincrement())
  name    String   @unique
  userId  Int?
  user    User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
  members Member[]
  bills   Bill[]
}

model Member {
  id      Int     @id @default(autoincrement())
  name    String
  roomId  Int
  room    Room    @relation(fields: [roomId], references: [id], onDelete: Cascade)
  shares  Share[]
}

model Bill {
  id           Int      @id @default(autoincrement())
  title        String
  amountCents  Int
  period       String   // "YYYY-MM"
  rule         SplitRule @default(EQUAL)
  meta         Json?
  roomId       Int
  room         Room     @relation(fields: [roomId], references: [id], onDelete: Cascade)
  shares       Share[]
  createdAt    DateTime @default(now())
}

enum SplitRule {
  EQUAL
  PERCENT
  WEIGHT
}

model Share {
  id          Int     @id @default(autoincrement())
  billId      Int
  bill        Bill    @relation(fields: [billId], references: [id], onDelete: Cascade)
  memberId    Int
  member      Member  @relation(fields: [memberId], references: [id], onDelete: Cascade)
  amountCents Int
  paid        Boolean @default(false)

  @@unique([billId, memberId])
}
